<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第五讲 推荐系统-后端开发-推荐篇（上） | 推荐系统开发文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/nomoe/favicon.ico">
    <meta name="description" content="News Demo Doc">
    
    <link rel="preload" href="/nomoe/assets/css/0.styles.46c87d11.css" as="style"><link rel="preload" href="/nomoe/assets/js/app.b0634cdc.js" as="script"><link rel="preload" href="/nomoe/assets/js/2.e531c252.js" as="script"><link rel="preload" href="/nomoe/assets/js/24.52c6dafe.js" as="script"><link rel="prefetch" href="/nomoe/assets/js/10.f8c2e7ab.js"><link rel="prefetch" href="/nomoe/assets/js/11.a72faa70.js"><link rel="prefetch" href="/nomoe/assets/js/12.2932e2a5.js"><link rel="prefetch" href="/nomoe/assets/js/13.680ff2e4.js"><link rel="prefetch" href="/nomoe/assets/js/14.e1056133.js"><link rel="prefetch" href="/nomoe/assets/js/15.14c6f790.js"><link rel="prefetch" href="/nomoe/assets/js/16.feab6203.js"><link rel="prefetch" href="/nomoe/assets/js/17.da74545f.js"><link rel="prefetch" href="/nomoe/assets/js/18.dfbc94c1.js"><link rel="prefetch" href="/nomoe/assets/js/19.5e254fde.js"><link rel="prefetch" href="/nomoe/assets/js/20.f8be3a04.js"><link rel="prefetch" href="/nomoe/assets/js/21.83956418.js"><link rel="prefetch" href="/nomoe/assets/js/22.d0011416.js"><link rel="prefetch" href="/nomoe/assets/js/23.e1c4e5da.js"><link rel="prefetch" href="/nomoe/assets/js/25.544fbff6.js"><link rel="prefetch" href="/nomoe/assets/js/26.5fd376d5.js"><link rel="prefetch" href="/nomoe/assets/js/27.4a83da68.js"><link rel="prefetch" href="/nomoe/assets/js/3.b79a0801.js"><link rel="prefetch" href="/nomoe/assets/js/4.21c265ed.js"><link rel="prefetch" href="/nomoe/assets/js/5.67bfa7f8.js"><link rel="prefetch" href="/nomoe/assets/js/6.c01f87cc.js"><link rel="prefetch" href="/nomoe/assets/js/7.ea71c5c9.js"><link rel="prefetch" href="/nomoe/assets/js/8.f6d4234c.js"><link rel="prefetch" href="/nomoe/assets/js/9.906cc110.js">
    <link rel="stylesheet" href="/nomoe/assets/css/0.styles.46c87d11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nomoe/" class="home-link router-link-active"><img src="/nomoe/logo.gif" alt="推荐系统开发文档" class="logo"> <span class="site-name can-hide">推荐系统开发文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nomoe/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="推荐系统开发" class="dropdown-title"><span class="title">推荐系统开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="推荐系统开发" class="mobile-dropdown-title"><span class="title">推荐系统开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nomoe/develop/01/" class="nav-link">
  第一讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/02/" class="nav-link">
  第二讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/03/" class="nav-link">
  第三讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/04/" class="nav-link">
  第四讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/05/" class="nav-link router-link-active">
  第五讲
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nomoe/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="推荐系统开发" class="dropdown-title"><span class="title">推荐系统开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="推荐系统开发" class="mobile-dropdown-title"><span class="title">推荐系统开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nomoe/develop/01/" class="nav-link">
  第一讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/02/" class="nav-link">
  第二讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/03/" class="nav-link">
  第三讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/04/" class="nav-link">
  第四讲
</a></li><li class="dropdown-item"><!----> <a href="/nomoe/develop/05/" class="nav-link router-link-active">
  第五讲
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/nomoe/develop/05/" aria-current="page" class="sidebar-link">第五讲 推荐系统 前言</a></li><li><a href="/nomoe/develop/05/user.html" class="sidebar-link">第五讲 推荐系统-后端开发-用户篇</a></li><li><a href="/nomoe/develop/05/rec-01.html" aria-current="page" class="active sidebar-link">第五讲 推荐系统-后端开发-推荐篇（上）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#新闻推荐评分表" class="sidebar-link">新闻推荐评分表</a></li></ul></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_1、随机推荐" class="sidebar-link">1、随机推荐</a></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_2、基于内容的推荐-基于当前新闻" class="sidebar-link">2、基于内容的推荐-基于当前新闻</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_1、分析" class="sidebar-link">1、分析</a></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_2、实践" class="sidebar-link">2、实践</a></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_3、测试" class="sidebar-link">3、测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_3、用户浏览评分记录" class="sidebar-link">3、用户~~浏览~~评分记录</a></li><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_4、基于内容的推荐-基于用户偏好" class="sidebar-link">4、基于内容的推荐，基于用户偏好</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nomoe/develop/05/rec-01.html#_1、分析和实践" class="sidebar-link">1、分析和实践</a></li></ul></li></ul></li><li><a href="/nomoe/develop/05/rec-02.html" class="sidebar-link">第五讲 推荐系统-后端开发-推荐篇（下）</a></li><li><a href="/nomoe/develop/05/front.html" class="sidebar-link">第五讲 推荐系统-前端开发</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第五讲-推荐系统-后端开发-推荐篇-上"><a href="#第五讲-推荐系统-后端开发-推荐篇-上" class="header-anchor">#</a> 第五讲 推荐系统-后端开发-推荐篇（上）</h1> <hr> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>先看看新闻推荐评分表</p> <h3 id="新闻推荐评分表"><a href="#新闻推荐评分表" class="header-anchor">#</a> 新闻推荐评分表</h3> <table><thead><tr><th>编号</th> <th>项目</th> <th>分值</th></tr></thead> <tbody><tr><td>T1</td> <td>随机推荐</td> <td>1</td></tr> <tr><td>T2</td> <td>基于内容的推荐，基于当前新闻</td> <td>1</td></tr> <tr><td>T3</td> <td>基于内容的推荐，基于用户偏好</td> <td>1</td></tr> <tr><td>T4</td> <td>用户登录</td> <td>1</td></tr> <tr><td>T5</td> <td>用户浏览记录</td> <td>1</td></tr> <tr><td>T6</td> <td>相似用户</td> <td>1</td></tr> <tr><td>T7</td> <td>基于用户的协同过滤推荐</td> <td>1</td></tr> <tr><td>T8</td> <td>基于物品的协同过滤推荐</td> <td>1</td></tr> <tr><td></td> <td>总分</td> <td>8</td></tr></tbody></table> <p>当然啦，这张表里面的我们的登录已经完成了，接下来把剩下的完成吧</p> <h2 id="_1、随机推荐"><a href="#_1、随机推荐" class="header-anchor">#</a> 1、随机推荐</h2> <p>随机推荐没什么好说的，一条 <code>sql</code> 语句就能搞定</p> <p>新建新闻类 <code>News</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 新闻类
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">News</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> docno<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>mapper</code> 包下新建 <code>NewsMapper</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 新闻mapper
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsMapper</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 随机推荐10条新闻
     *
     * @param size: 获取几条新闻
     * @return 新闻列表
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM `article` WHERE id &gt;= (SELECT floor(RAND() * (SELECT MAX(id) FROM `article`))) ORDER BY id LIMIT #{size}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectNewsByRandom</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;size&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>service</code> 包下新建 <code>NewsService</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 随机推荐10条新闻
     *
     * @param size: 获取几条新闻
     * @return 新闻列表
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectNewsByRandom</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>impl</code> 包下新建实现类 <code>NewsServiceImpl</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">NewsMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">NewsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsMapper</span> newsMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 随机推荐10条新闻
     *
     * @param size: 获取几条新闻
     * @return 新闻列表
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectNewsByRandom</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsByRandom</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><code>api</code> 包下新建 <code>NewsApi</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PassToken</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/news&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsApi</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 一页展示几条
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> PAGE_SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsService</span> newsService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 随机推荐新闻
     *
     * @return 随机推荐新闻
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/random&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PassToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">randomRecommend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> newsService<span class="token punctuation">.</span><span class="token function">selectNewsByRandom</span><span class="token punctuation">(</span>PAGE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>效果：</p> <p><img src="https://img-blog.csdnimg.cn/b7caf5f641ce42f79c4c3e7aed907246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h2 id="_2、基于内容的推荐-基于当前新闻"><a href="#_2、基于内容的推荐-基于当前新闻" class="header-anchor">#</a> 2、基于内容的推荐-基于当前新闻</h2> <h3 id="_1、分析"><a href="#_1、分析" class="header-anchor">#</a> 1、分析</h3> <p>在推荐系统文档第六讲中，文档中给出的思路是</p> <img src="https://img-blog.csdnimg.cn/4e14d19b2e194a1abd3592c89cf58eec.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="&lt;img src=&quot;5_推荐系统_后端开发_2推荐篇（上）.assets/image-20210801185705924.png&quot; alt=&quot;image-20210801185705924&quot; style=&quot;zoom:80%;&quot;   /&gt;"> <p>不过，我认为这种余弦的方法效果可能一般，所以我并不打算采用这种方法，但是总体思路是没变的，就是把它转化成根据多个关键词搜索新闻的问题。</p> <p>找出当前新闻出现频率最高的n个词汇，这n个词汇就作为能代表新闻的关键词，然后再找出包含这些词汇的新闻，最后再根据一定的权重公式计算新闻的权重并排序，那么权重怎么算呢？</p> <p>词汇的tfidf一定程度上能体现词汇在新闻中出现的次数，值越大，说明出现的次数越多，说明关键词与候选新闻的关系越紧密</p> <p>尝试：假设我们找出候选新闻出现当前新闻的关键词的tfidf值或bayes值，然后累加，以此为权重，这里我用tfidf举例，即</p> <blockquote><p>score += 词汇在某篇新闻中的tfidf</p></blockquote> <p>举个栗子，假设 <code>北大，清华</code>，能代表某篇新闻，在候选新闻中，每篇新闻的权重计算如下</p> <p>新闻一：出现北大，清华</p> <blockquote><p>score = 北大在新闻一中的tfidf + 清华在新闻一中的tfidf = 2.333333 + 8.888888</p></blockquote> <p>新闻二：只出现北大</p> <blockquote><p>score = 北大在新闻一中的tfidf + 清华在新闻一中的tfidf = 2.333333 + 0 （未出现的关键词的tfidf为0）</p></blockquote> <p>当然，我还加入了另一个参数，即关键词在新闻中的频率权重，因为上面的算法存在缺陷</p> <p>例如，假设 <code>北大，清华</code>，能代表某篇新闻，<code>北大</code>出现了1次，而 <code>清华</code> 出现了99次，假设 <code>北大</code> 在候选新闻一中tfidf是10，<code>清华</code> 是5，那么按照上面的方法，算出的的分是15，假设 <code>北大</code> 在候选新闻二中tfidf是4，<code>清华</code> 是10，那么按照上面的方法，算出的得分是14，那么候选新闻一会被推荐，但是事实上不应该推荐候选新闻一，因为它出现清华的次数没有候选新闻二多，但是总分却比候选新闻二大，这是不合理的，说明算法存在问题，因此我们可以增加关键词在新闻中的频率权重这个参数，让这个参数作为加权参数，然后计算公式改为</p> <blockquote><p>score += 词汇在某篇新闻中的tfidf × ( 词在新闻中的频率 /  新闻总词汇数 )</p></blockquote> <p>利用后面这个参数可以给tfidf加权或者减权，还是上面的例子，这时候新闻一的得分为10 × ( 1 / 100 ) + 5 × ( 99 / 100 ) = 5.05，而新闻二的得分为4 × ( 1 / 100 ) + 10 × ( 99 / 100 ) = 9.94，这时候新闻二的权重就比新闻一大了，所以它理应被推荐</p> <p>所以现在我们的总体思路就是：</p> <ul><li><p>根据当前新闻id，在 <code>article_word</code> 表中，获取新闻的所有关键词及其频次</p></li> <li><p>根据每个关键词，查询包含这些关键词的新闻</p></li> <li><p>根据计算公式，计算每篇新闻的权重</p></li> <li><p>根据权重排序</p></li> <li><p>选择前N篇新闻推荐给用户</p></li></ul> <h3 id="_2、实践"><a href="#_2、实践" class="header-anchor">#</a> 2、实践</h3> <p>在 <code>NewsApi</code> 中开始编写方法和大致思路：</p> <p>recByCurrent中的rec是recommend的缩写</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
	* 根据当前浏览的新闻推荐新闻
	* @param id 新闻id
	* @return 推荐的新闻
	*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/recByCurrent&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PassToken</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">recommendByCurrentNews</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.获取新闻关键词和对应频率表</span>
  
  	<span class="token comment">// 2.生成关键词列表</span>

    <span class="token comment">// 3.根据关键词列表搜索相关联的新闻，并根据我们的算法排序</span>

    <span class="token comment">// 4.返回结果</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> reslut<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_1、获取新闻关键词和对应频率表"><a href="#_1、获取新闻关键词和对应频率表" class="header-anchor">#</a> 1、获取新闻关键词和对应频率表</h4> <p>这一步就是根据新闻id从article_word表中获取新闻关键词，一条sql语句就能搞定</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> word<span class="token punctuation">,</span>freqs <span class="token keyword">from</span> article_word <span class="token keyword">where</span> article_id <span class="token operator">=</span> ${id}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这条sql语句执行起来很慢，因此我们需要提前新建索引</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> index_article_id <span class="token keyword">on</span> article_word<span class="token punctuation">(</span><span class="token punctuation">`</span>article_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>freqs<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>word<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>过程比较慢，可能要好几个小时</p> <p>在 <code>entity</code> 包下新建类<code>ArticleWord</code>，不过这里我为了统一名字就把 <code>ArticleWord</code> 改成 <code>NewsWord</code> ，其实Article是新闻的意思，新闻应该用News，不过大家随便选一个，只要能理解什么意思就行</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsWord</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> articleId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> word<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> freqs<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> tfidf<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> bayes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>然后编写对应的mapper，service和service的实现类即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsWord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 新闻关键词mapper
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsWordMapper</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 根据id查询新闻的关键词与频次
     *
     * @param id id
     * @return 关键词与频次映射
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select word, freqs FROM `article_word` where article_id = #{id} ORDER BY freqs desc limit 10&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWordFreqById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsWord</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsWordService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 根据id查询新闻的关键词与频次（按频次降序排列）
     *
     * @param id id
     * @return 关键词与频次映射
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWordFreqById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsWord</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">NewsWordMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsWordService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsWordServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">NewsWordService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsWordMapper</span> newsWordMapper<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 根据id查询新闻的关键词与频次
     *
     * @param id id
     * @return 关键词与频次映射
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWordFreqById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsWordMapper<span class="token punctuation">.</span><span class="token function">getWordFreqById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>NewsApi</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1.获取新闻关键词</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> newsWords <span class="token operator">=</span> newsWordService<span class="token punctuation">.</span><span class="token function">getWordFreqById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2、生成关键词列表"><a href="#_2、生成关键词列表" class="header-anchor">#</a> 2、生成关键词列表</h4> <p>直接遍历map，从 <code>NewsWord</code> 中获取关键词即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 2.生成关键词列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NewsWord</span> word <span class="token operator">:</span> newsWords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keywordList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>word<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_3、根据关键词搜索相关联的新闻-并根据我们的算法排序"><a href="#_3、根据关键词搜索相关联的新闻-并根据我们的算法排序" class="header-anchor">#</a> 3、根据关键词搜索相关联的新闻，并根据我们的算法排序</h4> <p>首先，上面已经提到过，把包含关键词列表中的关键词的所有新闻都挑选出来，因此我们的sql语句大概如下</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> article_id<span class="token punctuation">,</span> word<span class="token punctuation">,</span> tfidf <span class="token keyword">from</span> article_word <span class="token keyword">where</span> word <span class="token operator">=</span> <span class="token comment">#{keyword} ORDER BY tfidf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后先编写mapper：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词查询包含关键词的新闻id和tfidf
 *
 * @param keyword 关键词
 * @return 列表
 */</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select article_id, word, tfidf from article_word where word = #{keyword} ORDER BY tfidf&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectNewsWordsByKeyWord</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;keyword&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后编写service：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词列表搜索新闻
 *
 * @param keywordList 关键词列表
 * @return 搜索结果
 */</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>编写service实现类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词列表搜索新闻
 *
 * @param keywordList 关键词列表
 * @return 搜索结果
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>那么问题来了，这里面逻辑该怎么写？</p> <p>首先我们已经拿到了关键词列表，所以，第一步应该是根据关键词列表搜索包含关键词的新闻id，和关键词在新闻中的<code>tfidf</code>，第二步就是根据这些数据按照我们的算法进行排序并且挑选前N篇新闻，第三步根据这前N篇新闻的id回表查询新闻的详细信息</p> <p>当然了，这里我们还要在方法参数里传入页码 <code>pageNumber</code> 和一页的大小 <code>pageSize</code>，之前我并没有实现新闻分词查询的功能，现在大家可以仔细分析一下，其实新闻分词的查询和这个的业务逻辑是一样的，我们只是把根据当前新闻推荐转化成为搜索问题而已，然而搜索肯定需要分页，分页就需要页码和一页的大小，所以我们再添加这两个参数</p> <p>修改service：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词列表搜索新闻
 *
 * @param keywordList 关键词列表
 * @return 搜索结果
 */</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>修改service实现类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
	* 根据关键词列表搜索新闻
	*
	* @param keywordList 关键词列表
	* @return 搜索结果
	*/</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>然后就可以继续编写业务了，代码还是比较容易理解的</p> <p>首先是定义变量</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 关键词频率表</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> freqMap <span class="token operator">=</span> <span class="token function">calculateFrequency</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 关键词列表长度</span>
<span class="token keyword">int</span> keywordsSize <span class="token operator">=</span> keywords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 关键词列表去重</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> removeDuplicateKeywords <span class="token operator">=</span> <span class="token function">removeDuplicate</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 新闻关键词列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> newsWords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 新闻得分表</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> scoreMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里涉及到两个方法，<code>calculateFrequency</code> 和 <code>removeDuplicate</code>，前者是生成 关键词-频率 表，后者是关键词列表去重，因为关键词列表可能包含重复的关键词，我们在数据库查询的时候同一个关键词查一遍就行</p> <p>两个方法的代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 计算每个关键词词出现的次数
 *
 * @param keywords 关键词
 * @return 关键词和频次的映射
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">calculateFrequency</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> keywordsFreqMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    keywords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keywordsFreqMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            keywordsFreqMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> keywordsFreqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            keywordsFreqMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> keywordsFreqMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * list去重
 *
 * @param list 列表
 * @param &lt;T&gt;  泛型
 * @return 去重后的列表
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">removeDuplicate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>根据每个关键词搜索相关新闻，然后把搜索结果合并，由于搜索结果是新闻关键词列表，所以用 <code>addAll</code> 方法合并</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 根据每个关键词搜索相关新闻，然后把搜索结果合并</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> keyword <span class="token operator">:</span> removeDuplicateKeywords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newsWords<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsWordsByKeyWord</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>计算每篇新闻对应的权重，放到一个Map里面</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 计算新闻对应的权重</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NewsWord</span> newsWord <span class="token operator">:</span> newsWords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Double</span> score <span class="token operator">=</span> scoreMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getRid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getRid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> score <span class="token operator">+</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getRid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>接下来就是排序了，首先编写对map根据值排序的方法，由于这个方法比较通用，所以我们可以抽取到一个工具类里面，新建一个utils包，存放工具类，并新建 <code>CommonUtil</code> 类，编写下面的代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
	* 对map里面的元素根据值的大小进行排序
	*
	* @param map 要排序的map
	* @return 排序好的map
	*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">sortMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//自定义比较器</span>
  <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> valCmp <span class="token operator">=</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> o2<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//将map转成List，map的一组key，value对应list一个存储空间</span>
  <span class="token comment">//传入maps实体</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>valCmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>此外，<code>removeDuplicate</code> 列表去重方法也比较通用，所以我们也提取到 <code>CommonUtil</code> 里面</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> removeDuplicateKeywords <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">removeDuplicate</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在 <code>searchByKeyWordList</code> 方法里面调用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">sortMap</span><span class="token punctuation">(</span>scoreMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就是分页了：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>pageNum <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newsList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsById</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里我们还差个根据新闻id搜索新闻，所以我们还需要再mapper中新增方法<code>selectNewsById</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
	* 根据id查询新闻
	*
	* @param id 新闻id
	* @return 新闻
	*/</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from article where id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">News</span> <span class="token function">selectNewsById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>最后return即可</p> <p>service写完了，然后完善一下controller即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 3.根据关键词列表搜索相关联的新闻，并根据我们的算法排序</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> newsService<span class="token punctuation">.</span><span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 4.返回结果</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这是页码是1，一页的大小是10，这两个不需要当成参数，因为我们拿的是前十条，也就是推荐的 <code>top10</code>，希望大家不要疑惑</p> <h3 id="_3、测试"><a href="#_3、测试" class="header-anchor">#</a> 3、测试</h3> <p><img src="https://img-blog.csdnimg.cn/a5956aa39c5b479f85b0355568b1cff6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <h2 id="_3、用户浏览评分记录"><a href="#_3、用户浏览评分记录" class="header-anchor">#</a> 3、用户<s>浏览</s>评分记录</h2> <p>用户浏览记录，更准确的说，应该是评分记录，评分的话分为质量评分和兴趣评分，质量评分就是这篇新闻的内容是否优质，是水文还是干货，兴趣评分就是你对这篇新闻的类型是否感兴趣。当然啦，表我们已经建好了，所以现在差个 <code>select</code>，<code>insert</code> 和 <code>update</code></p> <p>由于都是基础的方法，这里我就不多BB了~对于想让基础操作的代码更简洁的童鞋，可以考虑用通用mapper，具体自行了解~</p> <p>新建新闻评分类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>format<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 新闻评分记录
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsRate</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> interest<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> quality<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span>fallbackPatterns <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> cdt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>mapper</code> 包下新建 <code>NewsRateMapper</code>，编写适用于我们这个项目的增改查方法，然后由于新闻推荐评分表还有获取用户最近五条评分记录的需求，因此我们还要增加查询最近五条评分记录的方法，当然这个值可以设置成一个参数，不过我这里直接写死就行，产品经理敢变需求就打死ta</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsRate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Insert</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 新闻浏览和评分mapper
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsRateMapper</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 插入用户对某新闻的评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into `view`(user_id, article_id, interest, quality, cdt)values (#{newsRate.userId}, #{newsRate.articleId}, #{newsRate.interest}, #{newsRate.quality}, #{newsRate.cdt})&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">insertNewsRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsRate&quot;</span><span class="token punctuation">)</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新用户对某新闻的兴趣评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update `view` set interest=#{newsRate.interest}, quality=#{newsRate.quality} where user_id=#{newsRate.userId} and article_id = #{newsRate.articleId}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">void</span> <span class="token function">updateNewsRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsRate&quot;</span><span class="token punctuation">)</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 根据用户id和新闻id查询评分记录
     *
     * @param userId 用户id
     * @param newsId 新闻id
     * @return 用户浏览记录
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from `view` where user_id = #{userId} and article_id = #{newsId}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">NewsRate</span> <span class="token function">selectNewsRateById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> newsId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询所有评分记录
     *
     * @return 所有用户的所有评分记录
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from `view`&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsRate</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询最近五条评分记录
     *
     * @param userId 用户id
     * @return 用户最近五条评分记录
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select b.* from `view` a , `article` b where a.article_id = b.id and a.user_id = #{userId} order by a.cdt desc limit 5&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectRecent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p><code>service</code> 包下新建 <code>NewsRateService</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsRate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NewsRateService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 插入用户对某新闻的评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token keyword">void</span> <span class="token function">insertNewsRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsRate&quot;</span><span class="token punctuation">)</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新用户对某新闻的兴趣评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token keyword">void</span> <span class="token function">updateNewsRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsRate&quot;</span><span class="token punctuation">)</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 根据用户id和新闻id查询浏览记录
     *
     * @param userId 用户id
     * @param newsId 新闻id
     * @return 用户浏览记录
     */</span>
    <span class="token class-name">NewsRate</span> <span class="token function">selectNewsRateById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;newsId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> newsId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询所有浏览记录
     *
     * @return 所有用户的所有浏览记录
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsRate</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询最近五条浏览记录
     *
     * @param userId 用户id
     * @return 用户最近五条浏览记录
     */</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectRecentRateRecords</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>实现类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">News</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsRate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">NewsRateMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsRateService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsRateServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">NewsRateService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsRateMapper</span> newsRateMapper<span class="token punctuation">;</span>


    <span class="token comment">/**
     * 插入用户对某新闻的评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertNewsRate</span><span class="token punctuation">(</span><span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsRateMapper<span class="token punctuation">.</span><span class="token function">insertNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 更新用户对某新闻的兴趣评分
     *
     * @param newsRate 新闻浏览对象
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateNewsRate</span><span class="token punctuation">(</span><span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsRateMapper<span class="token punctuation">.</span><span class="token function">updateNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据用户id和新闻id查询浏览记录
     *
     * @param userId 用户id
     * @param newsId 新闻id
     * @return 用户浏览记录
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">NewsRate</span> <span class="token function">selectNewsRateById</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">,</span> <span class="token keyword">long</span> newsId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsRateMapper<span class="token punctuation">.</span><span class="token function">selectNewsRateById</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> newsId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询所有浏览记录
     *
     * @return 所有用户的所有浏览记录
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsRate</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsRateMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询最近五条浏览记录
     *
     * @param userId 用户id
     * @return 用户最近五条浏览记录
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectRecentRateRecords</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newsRateMapper<span class="token punctuation">.</span><span class="token function">selectRecent</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p><code>api</code> 包下新建 <code>NewsRateApi</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequireToken</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsRate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsRateService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rate&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsRateApi</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsRateService</span> newsRateService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 获取用户评分过的最近五条新闻
     *
     * @param userInfo 用户信息
     * @return 用户评分过的最近五条新闻
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/recent&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">recentRateRecords</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectRecentRateRecords</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据新闻id获取新闻评分
     *
     * @param userInfo 用户信息
     * @param newsId   新闻id
     * @return 新闻的评分
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">getRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Integer</span> newsId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NewsRate</span> newsRate <span class="token operator">=</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectNewsRateById</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 为了更加安全，把一些字段屏蔽掉</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newsRate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setCdt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 对新闻进行评分
     *
     * @param userInfo 用户信息
     * @param newsRate 用户评分
     * @return 操作结果
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/submit&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">submitRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 给新闻评分的用户id赋值和评分日期</span>
        newsRate<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newsRate<span class="token punctuation">.</span><span class="token function">setCdt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断数据库是否已存在用户对新闻的评分记录</span>
        <span class="token class-name">NewsRate</span> databaseNewsRate <span class="token operator">=</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectNewsRateById</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsRate<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>databaseNewsRate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newsRateService<span class="token punctuation">.</span><span class="token function">insertNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            newsRateService<span class="token punctuation">.</span><span class="token function">updateNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>NO_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>首先注入<code>NewsRateService</code>，常规操作</p> <p>然后编写用户评分记录的 <code>API</code> 接口<code>NewsRateApi</code>，逻辑都比较简单，我就不再过多解释</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequireToken</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">NewsRate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">NewsRateService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/rate&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsRateApi</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsRateService</span> newsRateService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 获取用户评分过的最近五条新闻
     *
     * @param userInfo 用户信息
     * @return 用户评分过的最近五条新闻
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/recent&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">recentRateRecords</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectRecentRateRecords</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取新闻评分
     *
     * @param userInfo 用户信息
     * @param newsId   新闻id
     * @return 新闻的评分
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">getRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Integer</span> newsId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NewsRate</span> newsRate <span class="token operator">=</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectNewsRateById</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 为了更加安全，把一些字段屏蔽掉</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newsRate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            newsRate<span class="token punctuation">.</span><span class="token function">setCdt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 对新闻进行评分
     *
     * @param userInfo 用户信息
     * @param newsRate 用户评分
     * @return 操作结果
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/submit&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequireToken</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">submitRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> userInfo<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">NewsRate</span> newsRate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 给新闻评分的用户id赋值</span>
        newsRate<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断数据库是否已存在用户对新闻的评分记录</span>
        <span class="token class-name">NewsRate</span> databaseNewsRate <span class="token operator">=</span> newsRateService<span class="token punctuation">.</span><span class="token function">selectNewsRateById</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsRate<span class="token punctuation">.</span><span class="token function">getNewsId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>databaseNewsRate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newsRateService<span class="token punctuation">.</span><span class="token function">insertNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            newsRateService<span class="token punctuation">.</span><span class="token function">updateNewsRate</span><span class="token punctuation">(</span>newsRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>NO_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>然后利用ApiPost测试</p> <p><img src="https://img-blog.csdnimg.cn/3014535cf63d4af0b28d6f636a567950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="https://img-blog.csdnimg.cn/0efcae7d45dc4e279cdfbab7208d6974.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/92c1a07c645a405db781aad7c004591d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-kt0rJ0AF-1628153086730)(5_推荐系统_后端开发_2推荐篇（上）.assets/image-20210802163655163.png)]"></p> <h2 id="_4、基于内容的推荐-基于用户偏好"><a href="#_4、基于内容的推荐-基于用户偏好" class="header-anchor">#</a> 4、基于内容的推荐，基于用户偏好</h2> <p>假设用户在最近一段时间里查看 <em>k</em> 篇新闻的点击记录为ℎ = {𝑑1, 𝑑2, … , 𝑑𝑘}</p> <p>方法一：对𝑑1, 𝑑2, … , 𝑑𝑘分别求出最相似的 10 篇新闻，对 10*k 篇新闻去重，再按照相似度从高到低排序，并推荐前 10 篇新闻给用户。</p> <p>方法二：对𝑑1, 𝑑2, … , 𝑑𝑘求出用户平均偏好𝑑，然后找出与𝑑最相似的 10 篇新闻推荐给用户。</p> <p>方法三：对𝑑1, 𝑑2, … , 𝑑𝑘先进行聚类分析，然后找出与每个聚类均值最相似的 10 篇新闻，再按照相似度从高到低排序，推荐前 10 篇新闻给用户。</p> <p>在这里，我打算用方法一</p> <h3 id="_1、分析和实践"><a href="#_1、分析和实践" class="header-anchor">#</a> 1、分析和实践</h3> <p>首先我们要获取用户在最近一段时间里查看的k篇新闻，当然，这里的“查看”表述得不是很正确，应该是评分吧，所以我们要到评分表里查找最近的评分记录，最近的话就是按照评论时间降序排就行，而我们主要是想获取新闻的id，根据新闻的id就能进行下一步，所以我们看看这一步的sql语句该怎么写：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> article_id <span class="token keyword">from</span> <span class="token punctuation">`</span><span class="token keyword">view</span><span class="token punctuation">`</span> <span class="token keyword">where</span> user_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> cdt <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然，聪明的童鞋应该发现了， 其实我们前面已经编写了获取用户最近五条评分记录的方法，因此我们直接复用该方法即可~</p> <p>让我们回顾一下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 查询最近五条评分记录
 *
 * @param userId 用户id
 * @return 用户最近五条评分记录
 */</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select b.* from `view` a , `article` b where a.article_id = b.id and a.user_id = #{userId} order by a.cdt desc limit 5&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectRecent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>第二步是分别对每篇新闻求出最相似的10篇新闻</p> <p>我们在 <code>NewsService</code> 下新建一个方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据用户最近的评分记录推荐新闻
 *
 * @return 推荐的新闻
 */</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">recommendByUserRecentRate</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数的话暂时传个用户id就够了</p> <p>然后在 <code>NewsServiceImpl</code> 下编写实现方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据用户最近的评分记录推荐新闻
 *
 * @return 推荐的新闻
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">recommendByUserRecentRate</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.根据用户id查询出用户最近评分的新闻</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> newsRateMapper<span class="token punctuation">.</span><span class="token function">selectRecent</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当然别忘记先注入<code>NewsRateMapper</code>，因为查用户评分记录数据的mapper是<code>NewsRateMapper</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">NewsRateMapper</span> newsRateMapper<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就是遍历每一篇新闻查出最相似的10篇新闻，然后对 10*k 篇新闻去重，再按照相似度从高到低排序</p> <p>查找相似新闻我们其实已经写好逻辑了，其实就是根据当前新闻推荐相似新闻，本质上就是根据当前新闻关键词搜索相似新闻，所以我们可以尽量复用它的业务逻辑</p> <p>让我们回顾一下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词列表搜索新闻
 *
 * @param keywordList 关键词列表
 * @return 搜索结果
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关键词频率映射</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> freqMap <span class="token operator">=</span> <span class="token function">calculateFrequency</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关键词列表长度</span>
    <span class="token keyword">int</span> keywordsSize <span class="token operator">=</span> keywordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关键词列表去重</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> removeDuplicateKeywords <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">removeDuplicate</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 新闻关键词列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> newsWordList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 新闻得分表</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> scoreMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据每个关键词搜索相关新闻，然后把搜索结果合并</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> keyword <span class="token operator">:</span> removeDuplicateKeywords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsWordList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsWordsByKeyWord</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算新闻对应的权重</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NewsWord</span> newsWord <span class="token operator">:</span> newsWordList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Double</span> score <span class="token operator">=</span> scoreMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> score <span class="token operator">+</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 排序</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">sortMap</span><span class="token punctuation">(</span>scoreMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 分页</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>pageNumber <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>pageNumber <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsById</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newsList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>我们要的是什么？</p> <p>我们要的是得到新闻的id以及它的评分，还要经过排序筛出前十篇新闻，因此，我打算把以下代码提取到一个新的方法 <code>getSortNewsList</code>，方便我们复用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSortNewsList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关键词频率映射</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> freqMap <span class="token operator">=</span> <span class="token function">calculateFrequency</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关键词列表长度</span>
    <span class="token keyword">int</span> keywordsSize <span class="token operator">=</span> keywordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关键词列表去重</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> removeDuplicateKeywords <span class="token operator">=</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">removeDuplicate</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 新闻关键词列表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> newsWordList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 新闻得分表</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> scoreMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据每个关键词搜索相关新闻，然后把搜索结果合并</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> keyword <span class="token operator">:</span> removeDuplicateKeywords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsWordList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsWordsByKeyWord</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算新闻对应的权重</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NewsWord</span> newsWord <span class="token operator">:</span> newsWordList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Double</span> score <span class="token operator">=</span> scoreMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> score <span class="token operator">+</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            scoreMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getArticleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newsWord<span class="token punctuation">.</span><span class="token function">getTfidf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> freqMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newsWord<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> keywordsSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 排序</span>
    <span class="token keyword">return</span> <span class="token class-name">CommonUtil</span><span class="token punctuation">.</span><span class="token function">sortMap</span><span class="token punctuation">(</span>scoreMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>然后原来的 <code>searchByKeyWordList</code> 改为：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据关键词列表搜索新闻
 *
 * @param keywordList 关键词列表
 * @return 搜索结果
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> <span class="token function">searchByKeyWordList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList<span class="token punctuation">,</span> <span class="token keyword">int</span> pageNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 计算排序后的新闻</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token function">getSortNewsList</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 分页</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>pageNumber <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>pageNumber <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newsList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsById</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newsList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>接下来开始编写循环：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 2.循环列表遍历每篇新闻，获取每篇新闻最相似的十篇新闻</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">News</span> news<span class="token operator">:</span> newsList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>首先是获取新闻的关键词列表，当然要注意这个列表要String的，而我们获得的是NewsWord，因此要处理一下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1.获取新闻关键词</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NewsWord</span><span class="token punctuation">&gt;</span></span> newsWordList <span class="token operator">=</span> newsWordService<span class="token punctuation">.</span><span class="token function">getWordFreqById</span><span class="token punctuation">(</span>news<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.生成关键词列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keywordList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NewsWord</span> word <span class="token operator">:</span> newsWordList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  keywordList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>word<span class="token punctuation">.</span><span class="token function">getWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>接下来利用我们重构好的方法 <code>getSortNewsList</code> 获取前十篇相似新闻及其得分：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 3.获取前十篇相似新闻及其得分</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token function">getSortNewsList</span><span class="token punctuation">(</span>keywordList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后呢？是要把它放在一个大的列表里，然后最后再根据排序吗？</p> <p>在这里，其实，由于我们使用的计算新闻相似度的方式是按照我们自己的算法来的，它计算出的得分并不是相似度，或者从某个角度来说，不同新闻的相似新闻得分之间不具有可比性，因此，我们又不能按照文档的思路来了，即“然后对 10*k 篇新闻去重，再按照相似度从高到低排序”这个思路我们不采纳，接下来介绍我的思路</p> <p>我们现在已经能计算出每篇新闻的相似新闻了，因此我打算采取我的思路，就是提取每篇新闻相似新闻的评分最高的两个，组合成一个列表，这个列表长度为10，也就是最终的列表</p> <p>这种方式的好处是很平均，用户最近评分的五篇新闻的相似新闻都能被推荐到，当然啦，如果我们想做得更好，可以考虑根据用户对新闻的评分对相似新闻加权，不过这里我就不搞得那么复杂了</p> <p>如果采取文档的思路，则有可能出现某篇新闻A的相似新闻相似度与它极大，数量也很多，然后按照文档的思路，只有新闻A的相似新闻会被推荐，其他新闻BCD...的相似新闻由于相似度略低而导致无法被推荐，这样一来，推荐列表里面都是新闻A的相似新闻，这样显然不是很好</p> <p>OK，讨论完了思路，接下来讨论怎么实现。其实很简单，我们只需要截取每篇新闻相似新闻列表的前两个放到最终列表即可，因为有5篇新闻嘛。然后问题在于，要是用户最近评分的新闻不足五篇咋办？</p> <p>没关系，那我们就改变一下要放几个，10除以5等于2，这个2我们可以改为动态计算。即假设用户最近评分的新闻为n，首先n不可能大于五，因为我们查数据库的时候已经限制了最多为5篇新闻，如果n小于五的话，则每篇新闻要添加相似新闻到最终新闻列表的数量为10/n，然后向上取整，假设n为4，10/4等于2.5，向上取整等于3，然后3*4等于12，这样超出了10，不过我们可以截取到10即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 计算每篇新闻要添加多少篇相似新闻</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">10.0</span> <span class="token operator">/</span> newsList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当然，我们还要准备最终的id列表</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 存放最终的新闻id列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> newsIdList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>截取前十条</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 截取前十条</span>
newsIdList<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>最后就是把这十篇新闻的详细信息查询出来即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 4.获取新闻详情</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> newsResultList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Long</span> newsId<span class="token operator">:</span> newsIdList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newsResultList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newsMapper<span class="token punctuation">.</span><span class="token function">selectNewsById</span><span class="token punctuation">(</span>newsId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后service就写完了，接下来写controller</p> <p>方法比较简单，调用service即可，不过多解释</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 根据用户最近评分记录推荐新闻
 * @param user 用户信息
 * @return 推荐的新闻
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/recByUserRecentRate&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequireToken</span>
<span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">recommendByUserRecentRate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@UserInfo</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">News</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> newsService<span class="token punctuation">.</span><span class="token function">recommendByUserRecentRate</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> <span class="token class-name">Message</span><span class="token punctuation">.</span>SUCCESS_MESSAGE<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>然后效果：
<img src="https://img-blog.csdnimg.cn/7217088109dd4dcda5a93700b6998e6d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2NDkxNTQ5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> <p>当然了，这种方法查数据库次数比较多，所以耗时比较久，大家可以想想怎么优化</p> <hr> <p>由于这份文档篇幅比较大了，因此T6、T7、T8我打算放到下一篇，详情见下篇</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nomoe/develop/05/user.html" class="prev">
        第五讲 推荐系统-后端开发-用户篇
      </a></span> <span class="next"><a href="/nomoe/develop/05/rec-02.html">
        第五讲 推荐系统-后端开发-推荐篇（下）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nomoe/assets/js/app.b0634cdc.js" defer></script><script src="/nomoe/assets/js/2.e531c252.js" defer></script><script src="/nomoe/assets/js/24.52c6dafe.js" defer></script>
  </body>
</html>
